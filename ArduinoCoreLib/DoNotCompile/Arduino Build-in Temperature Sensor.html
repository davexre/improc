<!DOCTYPE html>
<html lang="en-US"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<title>  ATMEGA Core Temperature Sensor</title>
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="http://www.narkidae.com/xmlrpc.php">
<!--[if lt IE 9]>
<script src="http://www.narkidae.com/wp-content/themes/esplanade/scripts/html5.js" type="text/javascript"></script>
<![endif]-->
<link rel="alternate" type="application/rss+xml" title="Narkidae » Feed" href="http://www.narkidae.com/feed/">
<link rel="alternate" type="application/rss+xml" title="Narkidae » Comments Feed" href="http://www.narkidae.com/comments/feed/">

            <div class="fit-vids-style">­<style>               .fluid-width-video-wrapper {                 width: 100%;                              position: relative;                       padding: 0;                            }                                                                                   .fluid-width-video-wrapper iframe,        .fluid-width-video-wrapper object,        .fluid-width-video-wrapper embed {           position: absolute;                       top: 0;                                   left: 0;                                  width: 100%;                              height: 100%;                          }                                       </style></div><script src="Arduino%20Build-in%20Temperature%20Sensor_files/ga.js" async="" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
            // Google Analytics for WordPress by Yoast v4.3.3 | http://yoast.com/wordpress/google-analytics/
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-38642589-1']);
				            _gaq.push(['_trackPageview']);
            (function () {
                var ga = document.createElement('script');
                ga.type = 'text/javascript';
                ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';

                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(ga, s);
            })();
            //]]></script>
			<link rel="alternate" type="application/rss+xml" title="Narkidae » ATMEGA Core Temperature Sensor Comments Feed" href="http://www.narkidae.com/research/atmega-core-temperature-sensor/feed/">
<link rel="stylesheet" id="shadowbox-css-css" href="Arduino%20Build-in%20Temperature%20Sensor_files/shadowbox.css" type="text/css" media="screen">
<link rel="stylesheet" id="shadowbox-extras-css" href="Arduino%20Build-in%20Temperature%20Sensor_files/extras.css" type="text/css" media="screen">
<link rel="stylesheet" id="theme-my-login-css" href="Arduino%20Build-in%20Temperature%20Sensor_files/theme-my-login.css" type="text/css" media="all">
<link rel="stylesheet" id="crayon-css" href="Arduino%20Build-in%20Temperature%20Sensor_files/crayon.css" type="text/css" media="all">
<link rel="stylesheet" id="crayon-theme-classic-css" href="Arduino%20Build-in%20Temperature%20Sensor_files/classic.css" type="text/css" media="all">
<link rel="stylesheet" id="crayon-font-monaco-css" href="Arduino%20Build-in%20Temperature%20Sensor_files/monaco.css" type="text/css" media="all">
<link rel="stylesheet" id="cptchStylesheet-css" href="Arduino%20Build-in%20Temperature%20Sensor_files/style_wp_before_3.css" type="text/css" media="all">
<link rel="stylesheet" id="sidebar-login-css" href="Arduino%20Build-in%20Temperature%20Sensor_files/sidebar-login.css" type="text/css" media="all">
<link rel="stylesheet" id="esplanade-web-font-css" href="Arduino%20Build-in%20Temperature%20Sensor_files/css.css" type="text/css" media="all">
<link rel="stylesheet" id="esplanade-css" href="Arduino%20Build-in%20Temperature%20Sensor_files/style.css" type="text/css" media="all">
<link rel="stylesheet" id="cpsh-shortcodes-css" href="Arduino%20Build-in%20Temperature%20Sensor_files/shortcodes.css" type="text/css" media="all">
<script type="text/javascript" src="Arduino%20Build-in%20Temperature%20Sensor_files/jquery_002.js"></script>
<script type="text/javascript" src="Arduino%20Build-in%20Temperature%20Sensor_files/jquery-migrate.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"2.4.3","is_admin":"0","ajaxurl":"http:\/\/www.narkidae.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type="text/javascript" src="Arduino%20Build-in%20Temperature%20Sensor_files/crayon.js"></script>
<script type="text/javascript" src="Arduino%20Build-in%20Temperature%20Sensor_files/blockui.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var sidebar_login_params = {"ajax_url":"http:\/\/www.narkidae.com\/wp-admin\/admin-ajax.php","force_ssl_login":"0","force_ssl_admin":"0","is_ssl":"0","i18n_username_required":"Please enter your username","i18n_password_required":"Please enter your password","error_class":"sidebar_login_error"};
/* ]]> */
</script>
<script type="text/javascript" src="Arduino%20Build-in%20Temperature%20Sensor_files/sidebar-login.js"></script>
<script type="text/javascript" src="Arduino%20Build-in%20Temperature%20Sensor_files/jquery.js"></script>
<script type="text/javascript" src="Arduino%20Build-in%20Temperature%20Sensor_files/fitvids.js"></script>
<script type="text/javascript" src="Arduino%20Build-in%20Temperature%20Sensor_files/swfobject.js"></script>
<script type="text/javascript" src="Arduino%20Build-in%20Temperature%20Sensor_files/audio-player.js"></script>
<script type="text/javascript" src="Arduino%20Build-in%20Temperature%20Sensor_files/comment-reply.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.narkidae.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.narkidae.com/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="Extruder" href="http://www.narkidae.com/projects/extruder/">
<meta name="generator" content="WordPress 3.6.1">
<link rel="canonical" href="http://www.narkidae.com/research/atmega-core-temperature-sensor/">
<script>
/* <![CDATA[ */
	jQuery(document).ready(function($) {
		$('.nav-toggle').click(function() {
			$('#access div ul:first-child').slideToggle(250);
			return false;
		});
		if( ($(window).width() > 640) || ($(document).width() > 640) ) {
							$('#access li').mouseenter(function() {
					$(this).children('ul').css('display', 'none').stop(true, true).slideToggle(250).css('display', 'block').children('ul').css('display', 'none');
				});
				$('#access li').mouseleave(function() {
					$(this).children('ul').stop(true, true).fadeOut(250).css('display', 'block');
				})
					} else {
			$('#access li').each(function() {
				if($(this).children('ul').length)
					$(this).append('<span class="drop-down-toggle"><span class="drop-down-arrow"></span></span>');
			});
			$('.drop-down-toggle').click(function() {
				$(this).parent().children('ul').slideToggle(250);
			});
		}
				$(".entry-attachment, .entry-content").fitVids({ customSelector: "iframe, object, embed"});
	});
	jQuery(window).load(function() {
			});
	AudioPlayer.setup("http://www.narkidae.com/wp-content/themes/esplanade/audio-player/player.swf", {  
		width: 320  
	});
/* ]]> */
</script><style media="screen" type="text/css">p.audioplayer_container span {visibility:hidden;height:24px;overflow:hidden;padding:0;border:none;}</style>
<style type="text/css">
												.content-sidebar-wrap {
			width:83.42%;
		}
		.page-template-template-sidebar-content-sidebar-php .content-sidebar-wrap #content {
			width:83.42%;
		}
		.page-template-template-sidebar-content-sidebar-php #sidebar-left {
			width:14.48%;
		}
		.page-template-template-sidebar-content-sidebar-php #sidebar-right {
			width:14.48%;
		}
		@media screen and (max-width: 960px) {
			.content-sidebar-wrap,
			.page-template-template-sidebar-content-sidebar-php .content-sidebar-wrap #content,
			.page-template-template-sidebar-content-sidebar-php #sidebar-left,
			.page-template-template-sidebar-content-sidebar-php #sidebar-right {
				float:none;
				width:auto;
			}
		}
		@media screen and (max-width: 640px) {
			.page-template-template-sidebar-content-sidebar-php #sidebar-left {
				float:left;
				width:49.65%;
			}
			.page-template-template-sidebar-content-sidebar-php #sidebar-right {
				float:right;
				width:43.45%;
			}
		}
							.blog #content {
			box-shadow:none;
			background:none;
		}
		.blog .post {
			padding:2.7%;
			margin-bottom:2.7%;
			box-shadow:0 0 3px #999;
			background:#fff;
		}
		.blog #posts-nav {
			padding:20px;
			margin-bottom:20px;
			box-shadow:0 0 3px #999;
			background:#fff;
			border-top:none;
		}
		.paged #content {
			margin-bottom:1.76%;
			box-shadow:0 0 3px #999;
			background:#fff;
		}
		.paged .post {
			padding:4.28% 0;
			margin:0 20px;
			box-shadow:none;
			background:none;
			border-top:#eee 1px solid;
		}
		.paged #posts-nav {
			padding:20px 0 0;
			margin:20px;
			margin-top:0;
			box-shadow:none;
			background:none;
			border-top:#eee 1px solid;
		}
																.entry-content {
			font-size:13px;
			line-height:1.62em;
		}
		@media screen and (max-width: 640px) {
			.entry-content {
				font-size:17px;
				line-height:1.62em;
			}
		}
																			</style>
<style type="text/css">
	#site-title,
	#site-description {
		position:absolute !important;
		clip:rect(1px 1px 1px 1px); /* IE6, IE7 */
		clip:rect(1px, 1px, 1px, 1px);
	}
	#header-image {
		margin:1.76% 0;
	}
</style>
<style type="text/css" id="custom-background-css">
body.custom-background { background-color: #9e9e9e; }
</style>
</head>

<body class="page page-id-583 page-child parent-pageid-36 page-template-default custom-background page-template-template-sidebar-content-sidebar-php">
	<div id="wrapper">
		<header id="header">
			<div id="site-title"><a href="http://www.narkidae.com/" rel="home">Narkidae</a></div>
							<div id="site-description">Electronics</div>
									<div class="clear"></div>
							<a href="http://www.narkidae.com/" rel="home">
					<img id="header-image" src="Arduino%20Build-in%20Temperature%20Sensor_files/Narkidae-Header-2.png" alt="Narkidae" height="135" width="1082">
				</a>
						<nav id="access">
				<a class="nav-toggle" href="#">Navigation</a>
				<div class="menu-default-container"><ul id="menu-default" class="menu"><li id="menu-item-197" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-197"><a href="http://www.narkidae.com/">Home</a></li>
<li id="menu-item-201" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-201"><a href="http://www.narkidae.com/blog/">Blog</a></li>
<li id="menu-item-95" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-95"><a href="http://www.narkidae.com/contact/">Contact</a></li>
<li id="menu-item-97" class="menu-item menu-item-type-post_type menu-item-object-page current-page-ancestor current-menu-ancestor current-menu-parent current-page-parent current_page_parent current_page_ancestor menu-item-97"><a href="http://www.narkidae.com/research/">Research</a>
<ul class="sub-menu">
	<li id="menu-item-135" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-135"><a href="http://www.narkidae.com/research/transferring-data-with-lcd-and-light-sensor/">LCD Transferring Data</a></li>
	<li id="menu-item-605" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-583 current_page_item menu-item-605"><a href="http://www.narkidae.com/research/atmega-core-temperature-sensor/">ATMEGA Core Temp</a></li>
</ul>
</li>
<li id="menu-item-460" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-460"><a href="http://www.narkidae.com/projects/">Projects</a>
<ul class="sub-menu">
	<li id="menu-item-303" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-303"><a href="http://www.narkidae.com/projects/manta-ray/">Manta Ray</a></li>
	<li id="menu-item-302" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-302"><a href="http://www.narkidae.com/projects/einstepper/">Einstepper</a></li>
	<li id="menu-item-535" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-535"><a href="http://www.narkidae.com/projects/transparent-seven-segment-display/">Transparent Display</a></li>
	<li id="menu-item-544" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-544"><a href="http://www.narkidae.com/projects/battery-shark/">Battery Shark</a></li>
</ul>
</li>
<li id="menu-item-537" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-537"><a href="http://www.narkidae.com/youtube/">Youtube</a></li>
</ul></div>				<form role="search" method="get" id="searchform" action="http://www.narkidae.com//">
	<input placeholder="Search this website…" name="s" id="s" type="text">
	<input id="searchsubmit" value="Search" type="submit">
</form>				<div class="clear"></div>
			</nav><!-- #access -->
		</header><!-- #header -->	<div id="container">
					<div class="content-sidebar-wrap">
				<section id="content">
							<article class="post-583 page type-page status-publish hentry" id="post-583">
					<div class="entry">
													<div id="location">
									<div id="breadcrumbs">
	<span class="prefix-text">You are here:</span>
	<a href="http://www.narkidae.com/" rel="home">Home</a>
	 › <a href="http://www.narkidae.com/research/" rel="bookmark">Research</a> › ATMEGA Core Temperature Sensor	</div>
							</div><!-- #location -->
												<header class="entry-header">
							<h1 class="entry-title">ATMEGA Core Temperature Sensor</h1>
						</header><!-- .entry-header -->
						<div class="entry-content">
							<h5>Abstract:</h5>
<p>I recently stumbled across an interesting fact in the datasheet for the ATMEGA32u4, the microcontroller I am using for my <a title="Einstepper" href="http://www.narkidae.com/projects/einstepper/">Einstepper Project</a>.
 I was surprised to find that Atmel had included a temperature sensor in
 the core of the device that you can read using the internal ADC. As it 
turns out, there are many megaAVR devices contain an internal 
temperature sensor. According to Atmel’s product finder, these devices 
are:<br>
</p><div class="one_half"><ul>
<li>AT90PWM161</li>
<li>AT90PWM81</li>
<li>ATmega168A</li>
<li>ATmega168P</li>
<li>ATmega168PA</li>
<li>ATmega16M1</li>
<li>ATmega16U4</li>
<li>ATmega328</li>
<li>ATmega328P</li>
</ul></div><div class="one_half last_column"><ul>
<li>ATmega32M1</li>
<li>ATmega32U4</li>
<li>ATmega48A</li>
<li>ATmega48P</li>
<li>ATmega48PA</li>
<li>ATmega64M1</li>
<li>ATmega88A</li>
<li>ATmega88P</li>
<li>ATmega88PA</li>
</ul></div><div class="clear_column"></div><br>
I was interested to see what temperature the microcontroller idled at 
and if this sensor could be used to detect the temperature of the room. 
By using a known temperature differential between the ambient air and 
core, it should be possible to calculate the ambient temperature. The 
Arduino Leonardo and Arduino Pro Micro use the ATMEGA32u4 so all the 
code below should work without modification. For other AVR boards that 
use a different chipset, minor modifications to the registers will be 
necessary.<p></p>
<h5><a href="http://www.narkidae.com/wp-content/uploads/2013/11/IMG_0720.png" rel="shadowbox[sbpost-583];player=img;"><img class="alignright  wp-image-483" alt="IMG_0720" src="Arduino%20Build-in%20Temperature%20Sensor_files/IMG_0720.png" height="200" width="200"></a>Hardware:</h5>
<p>I am using one of the boards from my Einstepper Project, but any 
board with one of the supported chips should work. There may be varying 
thermal characteristics between different packages (TQFP vs QFN) as well
 as different chips. These results are specifically for the ATMEGA32u4 
in the TQFP package.</p>
<h5>Software:</h5>
<p>The first step was to setup the ADC to be able to read the internal 
temperature sensor. In order to use the temperature sensor correctly, 
you must set the ADC reference to the 2.56V internal reference, set the 
multiplexer to the temperature sensor, and enable the ADC. The code I 
used to configure the ATMEGA32u4′s temperature sensor is as follows. 
This is specifically for the ATMEGA32u4 so if you are using a different 
chip, you should check the datasheet for the correct register values.</p><!-- Crayon Syntax Highlighter v2.4.3 -->

		<div id="crayon-52edbad1b7e3a258027487" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 11px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 11px !important;height: 16.5px !important; line-height: 16.5px !important;"><span class="crayon-title">setupADC</span>
			<div class="crayon-tools" style="font-size: 11px !important;height: 16.5px !important; line-height: 16.5px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div style="display: none;" class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 15.4px !important; line-height: 15.4px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="click" readonly="readonly" style="-moz-tab-size: 4; font-size: 11px ! important; line-height: 15px ! important; z-index: 0; opacity: 0; overflow: hidden;">void setupADC(){

  //ADC Multiplexer Selection Register
  ADMUX = 0;
  ADMUX |= (1 &lt;&lt; REFS1);  //Internal 2.56V Voltage Reference with external capacitor on AREF pin
  ADMUX |= (1 &lt;&lt; REFS0);  //Internal 2.56V Voltage Reference with external capacitor on AREF pin
  ADMUX |= (0 &lt;&lt; MUX4);  //Temperature Sensor - 100111
  ADMUX |= (0 &lt;&lt; MUX3);  //Temperature Sensor - 100111
  ADMUX |= (1 &lt;&lt; MUX2);  //Temperature Sensor - 100111
  ADMUX |= (1 &lt;&lt; MUX1);  //Temperature Sensor - 100111
  ADMUX |= (1 &lt;&lt; MUX0);  //Temperature Sensor - 100111

  //ADC Control and Status Register A 
  ADCSRA = 0;
  ADCSRA |= (1 &lt;&lt; ADEN);  //Enable the ADC
  ADCSRA |= (1 &lt;&lt; ADPS2);  //ADC Prescaler - 16 (16MHz -&gt; 1MHz)

  //ADC Control and Status Register B 
  ADCSRB = 0;
  ADCSRB |= (1 &lt;&lt; MUX5);  //Temperature Sensor - 100111
}</textarea></div>
			<div class="crayon-main" style="max-height: 500px; position: relative; z-index: 1; overflow: hidden;">
				<table style="" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 11px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-52edbad1b7e3a258027487-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e3a258027487-2">2</div><div class="crayon-num" data-line="crayon-52edbad1b7e3a258027487-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e3a258027487-4">4</div><div class="crayon-num" data-line="crayon-52edbad1b7e3a258027487-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e3a258027487-6">6</div><div class="crayon-num" data-line="crayon-52edbad1b7e3a258027487-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e3a258027487-8">8</div><div class="crayon-num" data-line="crayon-52edbad1b7e3a258027487-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e3a258027487-10">10</div><div class="crayon-num" data-line="crayon-52edbad1b7e3a258027487-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e3a258027487-12">12</div><div class="crayon-num" data-line="crayon-52edbad1b7e3a258027487-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e3a258027487-14">14</div><div class="crayon-num" data-line="crayon-52edbad1b7e3a258027487-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e3a258027487-16">16</div><div class="crayon-num" data-line="crayon-52edbad1b7e3a258027487-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e3a258027487-18">18</div><div class="crayon-num" data-line="crayon-52edbad1b7e3a258027487-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e3a258027487-20">20</div><div class="crayon-num" data-line="crayon-52edbad1b7e3a258027487-21">21</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 11px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-52edbad1b7e3a258027487-1"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">setupADC</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e3a258027487-2">&nbsp;</div><div class="crayon-line" id="crayon-52edbad1b7e3a258027487-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//ADC Multiplexer Selection Register</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e3a258027487-4"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">ADMUX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-52edbad1b7e3a258027487-5"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADMUX</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">REFS1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Internal 2.56V Voltage Reference with external capacitor on AREF pin</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e3a258027487-6"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADMUX</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">REFS0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Internal 2.56V Voltage Reference with external capacitor on AREF pin</span></div><div class="crayon-line" id="crayon-52edbad1b7e3a258027487-7"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADMUX</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">MUX4</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Temperature Sensor - 100111</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e3a258027487-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADMUX</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">MUX3</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Temperature Sensor - 100111</span></div><div class="crayon-line" id="crayon-52edbad1b7e3a258027487-9"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADMUX</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">MUX2</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Temperature Sensor - 100111</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e3a258027487-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADMUX</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">MUX1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Temperature Sensor - 100111</span></div><div class="crayon-line" id="crayon-52edbad1b7e3a258027487-11"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADMUX</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">MUX0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Temperature Sensor - 100111</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e3a258027487-12">&nbsp;</div><div class="crayon-line" id="crayon-52edbad1b7e3a258027487-13"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//ADC Control and Status Register A </span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e3a258027487-14"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">ADCSRA</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-52edbad1b7e3a258027487-15"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADCSRA</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">ADEN</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Enable the ADC</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e3a258027487-16"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADCSRA</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">ADPS2</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//ADC Prescaler - 16 (16MHz -&gt; 1MHz)</span></div><div class="crayon-line" id="crayon-52edbad1b7e3a258027487-17">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e3a258027487-18"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//ADC Control and Status Register B </span></div><div class="crayon-line" id="crayon-52edbad1b7e3a258027487-19"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">ADCSRB</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e3a258027487-20"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADCSRB</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">MUX5</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Temperature Sensor - 100111</span></div><div class="crayon-line" id="crayon-52edbad1b7e3a258027487-21"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0077 seconds] -->
<p>Here is the code I used to check the temperature sensor’s value. It 
starts the ADC conversion, waits for it to finish and then returns the 
temperature in degrees Celsius. The value returned by the temperature 
sensor is in kelvin, so you need to subtract 273 from it to get the 
temperature in Celsius. The code below is not calibrated, which is 
something you need to do after you get the temperature sensor working.</p><!-- Crayon Syntax Highlighter v2.4.3 -->

		<div id="crayon-52edbad1b7e52768735722" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 11px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 11px !important;height: 16.5px !important; line-height: 16.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 11px !important;height: 16.5px !important; line-height: 16.5px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div style="display: none;" class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 15.4px !important; line-height: 15.4px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="click" readonly="readonly" style="-moz-tab-size: 4; font-size: 11px ! important; line-height: 15px ! important; z-index: 0; opacity: 0; overflow: hidden;">int getTemp(){
  ADCSRA |= (1 &lt;&lt; ADSC);  //Start temperature conversion
  while (bit_is_set(ADCSRA, ADSC));  //Wait for conversion to finish
  byte low  = ADCL;
  byte high = ADCH;
  int temperature = (high &lt;&lt; 8) | low;  //Result is in kelvin
  return temperature - 273;
}</textarea></div>
			<div class="crayon-main" style="max-height: 500px; position: relative; z-index: 1; overflow: hidden;">
				<table style="" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 11px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-52edbad1b7e52768735722-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e52768735722-2">2</div><div class="crayon-num" data-line="crayon-52edbad1b7e52768735722-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e52768735722-4">4</div><div class="crayon-num" data-line="crayon-52edbad1b7e52768735722-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e52768735722-6">6</div><div class="crayon-num" data-line="crayon-52edbad1b7e52768735722-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e52768735722-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 11px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-52edbad1b7e52768735722-1"><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-e">getTemp</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e52768735722-2"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADCSRA</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">ADSC</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Start temperature conversion</span></div><div class="crayon-line" id="crayon-52edbad1b7e52768735722-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">bit_is_set</span><span class="crayon-sy">(</span><span class="crayon-i">ADCSRA</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">ADSC</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Wait for conversion to finish</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e52768735722-4"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-v">low</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">ADCL</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-52edbad1b7e52768735722-5"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-v">high</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">ADCH</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e52768735722-6"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">temperature</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">high</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-i">low</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Result is in kelvin</span></div><div class="crayon-line" id="crayon-52edbad1b7e52768735722-7"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-i">temperature</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">273</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e52768735722-8"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0037 seconds] -->
<p>And here is the setup and loop I used:</p><!-- Crayon Syntax Highlighter v2.4.3 -->

		<div id="crayon-52edbad1b7e5a382003194" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 11px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 11px !important;height: 16.5px !important; line-height: 16.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 11px !important;height: 16.5px !important; line-height: 16.5px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div style="display: none;" class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 15.4px !important; line-height: 15.4px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="click" readonly="readonly" style="-moz-tab-size: 4; font-size: 11px ! important; line-height: 15px ! important; z-index: 0; opacity: 0; overflow: hidden;">void setup(){
  //Start Serial Port
  Serial.begin(9600);

  setupADC();
}

void loop(){
  Serial.print("Time: ");
  Serial.print(millis());
  Serial.print(" Core Temperature: ");
  Serial.print(getTemp());
  Serial.println(" C");

  delay(1000);
}</textarea></div>
			<div class="crayon-main" style="max-height: 500px; position: relative; z-index: 1; overflow: hidden;">
				<table style="" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 11px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-52edbad1b7e5a382003194-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e5a382003194-2">2</div><div class="crayon-num" data-line="crayon-52edbad1b7e5a382003194-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e5a382003194-4">4</div><div class="crayon-num" data-line="crayon-52edbad1b7e5a382003194-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e5a382003194-6">6</div><div class="crayon-num" data-line="crayon-52edbad1b7e5a382003194-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e5a382003194-8">8</div><div class="crayon-num" data-line="crayon-52edbad1b7e5a382003194-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e5a382003194-10">10</div><div class="crayon-num" data-line="crayon-52edbad1b7e5a382003194-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e5a382003194-12">12</div><div class="crayon-num" data-line="crayon-52edbad1b7e5a382003194-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e5a382003194-14">14</div><div class="crayon-num" data-line="crayon-52edbad1b7e5a382003194-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e5a382003194-16">16</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 11px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-52edbad1b7e5a382003194-1"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">setup</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e5a382003194-2"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Start Serial Port</span></div><div class="crayon-line" id="crayon-52edbad1b7e5a382003194-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">begin</span><span class="crayon-sy">(</span><span class="crayon-cn">9600</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e5a382003194-4">&nbsp;</div><div class="crayon-line" id="crayon-52edbad1b7e5a382003194-5"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">setupADC</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e5a382003194-6"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-52edbad1b7e5a382003194-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e5a382003194-8"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">loop</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-52edbad1b7e5a382003194-9"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"Time: "</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e5a382003194-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-e">millis</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-52edbad1b7e5a382003194-11"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">" Core Temperature: "</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e5a382003194-12"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-e">getTemp</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-52edbad1b7e5a382003194-13"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">" C"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e5a382003194-14">&nbsp;</div><div class="crayon-line" id="crayon-52edbad1b7e5a382003194-15"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">delay</span><span class="crayon-sy">(</span><span class="crayon-cn">1000</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e5a382003194-16"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0034 seconds] -->
<p>This code should allow you to read the temperature sensor and print the temperature (in Celsius) to the serial port.</p>
<p>At this point, the temperature sensor has not been calibrated 
accurately, and according to the datasheet, the factory calibration is 
accurate to +- 10C. To calibrate the temperature, I held an ice cube 
against the ATMEGA32u4 (in a plastic bag so the board doesn’t get wet) 
until the temperature reading stabilized around 7C. Because water has an
 enthalpy of fusion of 0C (by definition of Celcius), the ice should be 
exactly 0C. Assuming there is sufficient thermal conduction, the core 
should be very close to 0C too. From this we know that the core 
temperature sensor reads 7C too high so I added an offset variable to 
the calculation as follows:</p><!-- Crayon Syntax Highlighter v2.4.3 -->

		<div id="crayon-52edbad1b7e63086029839" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 11px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 11px !important;height: 16.5px !important; line-height: 16.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 11px !important;height: 16.5px !important; line-height: 16.5px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div style="display: none;" class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 15.4px !important; line-height: 15.4px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="click" readonly="readonly" style="-moz-tab-size: 4; font-size: 11px ! important; line-height: 15px ! important; z-index: 0; opacity: 0; overflow: hidden;">#define TEMP_OFFSET -7
int getTemp(){
  ADCSRA |= (1 &lt;&lt; ADSC);  //Start temperature conversion
  while (bit_is_set(ADCSRA, ADSC));  //Wait for conversion to finish
  byte low  = ADCL;
  byte high = ADCH;
  int temperature = (high &lt;&lt; 8) | low;  //Result is in kelvin
  return temperature - 273 + TEMP_OFFSET;
}</textarea></div>
			<div class="crayon-main" style="max-height: 500px; position: relative; z-index: 1; overflow: hidden;">
				<table style="" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 11px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-52edbad1b7e63086029839-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e63086029839-2">2</div><div class="crayon-num" data-line="crayon-52edbad1b7e63086029839-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e63086029839-4">4</div><div class="crayon-num" data-line="crayon-52edbad1b7e63086029839-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e63086029839-6">6</div><div class="crayon-num" data-line="crayon-52edbad1b7e63086029839-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e63086029839-8">8</div><div class="crayon-num" data-line="crayon-52edbad1b7e63086029839-9">9</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 11px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-52edbad1b7e63086029839-1"><span class="crayon-p">#define TEMP_OFFSET -7</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e63086029839-2"><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-e">getTemp</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-52edbad1b7e63086029839-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADCSRA</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">ADSC</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Start temperature conversion</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e63086029839-4"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">bit_is_set</span><span class="crayon-sy">(</span><span class="crayon-i">ADCSRA</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">ADSC</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Wait for conversion to finish</span></div><div class="crayon-line" id="crayon-52edbad1b7e63086029839-5"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-v">low</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">ADCL</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e63086029839-6"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-v">high</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">ADCH</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-52edbad1b7e63086029839-7"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">temperature</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">high</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-i">low</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Result is in kelvin</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e63086029839-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-i">temperature</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">273</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-i">TEMP_OFFSET</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-52edbad1b7e63086029839-9"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0040 seconds] -->
<p>You will need to calculate this offset value for each chip since 
differences in manufacturing can result in the the chip reading up to 
10C too hot or 10C too cold.</p>
<p>So here is the complete program (for ATMEGA32u4, Registers will be different for other chips):</p><!-- Crayon Syntax Highlighter v2.4.3 -->

		<div id="crayon-52edbad1b7e6b339713411" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 11px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 11px !important;height: 16.5px !important; line-height: 16.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 11px !important;height: 16.5px !important; line-height: 16.5px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div style="display: none;" class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 15.4px !important; line-height: 15.4px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="click" readonly="readonly" style="-moz-tab-size: 4; font-size: 11px ! important; line-height: 15px ! important; z-index: 0; opacity: 0; overflow: hidden;">#define TEMP_OFFSET -7

void setupADC(){
  cli();  //Disable global interrupts

  //ADC Multiplexer Selection Register
  ADMUX = 0;
  ADMUX |= (1 &lt;&lt; REFS1);  //Internal 2.56V Voltage Reference with external capacitor on AREF pin
  ADMUX |= (1 &lt;&lt; REFS0);  //Internal 2.56V Voltage Reference with external capacitor on AREF pin
  ADMUX |= (0 &lt;&lt; MUX4);  //Temperature Sensor - 100111
  ADMUX |= (0 &lt;&lt; MUX3);  //Temperature Sensor - 100111
  ADMUX |= (1 &lt;&lt; MUX2);  //Temperature Sensor - 100111
  ADMUX |= (1 &lt;&lt; MUX1);  //Temperature Sensor - 100111
  ADMUX |= (1 &lt;&lt; MUX0);  //Temperature Sensor - 100111

  //ADC Control and Status Register A 
  ADCSRA = 0;
  ADCSRA |= (1 &lt;&lt; ADEN);  //Enable the ADC
  ADCSRA |= (1 &lt;&lt; ADPS2);  //ADC Prescaler - 16 (16MHz -&gt; 1MHz)

  //ADC Control and Status Register B 
  ADCSRB = 0;
  ADCSRB |= (1 &lt;&lt; MUX5);  //Temperature Sensor - 100111

  sei();  //Enable global interrupts
}

int getTemp(){
  ADCSRA |= (1 &lt;&lt; ADSC);  //Start temperature conversion
  while (bit_is_set(ADCSRA, ADSC));  //Wait for conversion to finish
  byte low  = ADCL;
  byte high = ADCH;
  int temperature = (high &lt;&lt; 8) | low;  //Result is in kelvin
  return temperature - 273 + TEMP_OFFSET;
}

void setup(){
  //Start Serial Port
  Serial.begin(9600);

  setupADC();
}

void loop(){
  Serial.print("Time: ");
  Serial.print(millis());
  Serial.print(" Core Temperature: ");
  Serial.print(getTemp());
  Serial.println(" C");

  delay(1000);
}</textarea></div>
			<div class="crayon-main" style="max-height: 500px; position: relative; z-index: 1; overflow: hidden;">
				<table style="" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 11px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-2">2</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-4">4</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-6">6</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-8">8</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-10">10</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-12">12</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-14">14</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-16">16</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-18">18</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-20">20</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-22">22</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-24">24</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-26">26</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-28">28</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-30">30</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-32">32</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-34">34</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-36">36</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-38">38</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-40">40</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-42">42</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-44">44</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-46">46</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-48">48</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-50">50</div><div class="crayon-num" data-line="crayon-52edbad1b7e6b339713411-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-52edbad1b7e6b339713411-52">52</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 11px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-1"><span class="crayon-p">#define TEMP_OFFSET -7</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-2">&nbsp;</div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-3"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">setupADC</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-4"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">cli</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Disable global interrupts</span></div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-6"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//ADC Multiplexer Selection Register</span></div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-7"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">ADMUX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADMUX</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">REFS1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Internal 2.56V Voltage Reference with external capacitor on AREF pin</span></div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-9"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADMUX</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">REFS0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Internal 2.56V Voltage Reference with external capacitor on AREF pin</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADMUX</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">MUX4</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Temperature Sensor - 100111</span></div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-11"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADMUX</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">MUX3</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Temperature Sensor - 100111</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-12"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADMUX</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">MUX2</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Temperature Sensor - 100111</span></div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-13"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADMUX</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">MUX1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Temperature Sensor - 100111</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-14"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADMUX</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">MUX0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Temperature Sensor - 100111</span></div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-16"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//ADC Control and Status Register A </span></div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-17"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">ADCSRA</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-18"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADCSRA</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">ADEN</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Enable the ADC</span></div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-19"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADCSRA</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">ADPS2</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//ADC Prescaler - 16 (16MHz -&gt; 1MHz)</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-20">&nbsp;</div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-21"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//ADC Control and Status Register B </span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-22"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">ADCSRB</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-23"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADCSRB</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">MUX5</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Temperature Sensor - 100111</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-24">&nbsp;</div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-25"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">sei</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Enable global interrupts</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-26"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-27">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-28"><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-e">getTemp</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-29"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">ADCSRA</span><span class="crayon-h"> </span><span class="crayon-o">|=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-i">ADSC</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Start temperature conversion</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-30"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">bit_is_set</span><span class="crayon-sy">(</span><span class="crayon-i">ADCSRA</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">ADSC</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Wait for conversion to finish</span></div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-31"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-v">low</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">ADCL</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-32"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-v">high</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">ADCH</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-33"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">temperature</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">high</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-i">low</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Result is in kelvin</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-34"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-i">temperature</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">273</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-i">TEMP_OFFSET</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-35"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-36">&nbsp;</div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-37"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">setup</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-38"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//Start Serial Port</span></div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-39"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">begin</span><span class="crayon-sy">(</span><span class="crayon-cn">9600</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-40">&nbsp;</div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-41"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">setupADC</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-42"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-43">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-44"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">loop</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-45"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"Time: "</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-46"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-e">millis</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-47"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">" Core Temperature: "</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-48"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-e">getTemp</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-49"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">" C"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-50">&nbsp;</div><div class="crayon-line" id="crayon-52edbad1b7e6b339713411-51"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">delay</span><span class="crayon-sy">(</span><span class="crayon-cn">1000</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-52edbad1b7e6b339713411-52"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0149 seconds] -->
<p></p>
<h5>Results:</h5>
<p>After logging the temperature for about 5 minutes and running the 
results through a 100 value running average filter, I generated the 
graph below.</p>
<p style="text-align: center;"><a href="http://www.narkidae.com/wp-content/uploads/2014/01/ATMEGA32u4-Core-Temp.png" rel="shadowbox[sbpost-583];player=img;"><img class="aligncenter  wp-image-599" alt="ATMEGA32u4 Core Temp" src="Arduino%20Build-in%20Temperature%20Sensor_files/ATMEGA32u4-Core-Temp.png" height="800" width="800"></a></p>
<p>Starting at 20C (room temperature), the microcontroller immediately 
starts heating rapidly until it reaches thermal equilibrium at around 
24C within 1 minute.</p>
<h5>Conclusion:</h5>
<p>So there you have it, The ATMEGA32u4 idles around 4C above ambient 
temperature. With this information we can measure ambient temperature by
 subtracting 4 from the temperature measurement after the chip has come 
to thermal equilibrium.</p>
							<div class="clear"></div>
						</div><!-- .entry-content -->
											</div><!-- .entry -->
					

								<div id="respond" class="comment-respond">
				<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="http://www.narkidae.com/research/atmega-core-temperature-sensor/#respond" style="display:none;">Cancel reply</a></small></h3>
									<p class="must-log-in">You must be <a href="http://www.narkidae.com/login/?redirect_to=http%3A%2F%2Fwww.narkidae.com%2Fresearch%2Fatmega-core-temperature-sensor%2F">logged in</a> to post a comment.</p>												</div><!-- #respond -->
			        <script type="text/javascript">
            jQuery(document).ready(function () {
                jQuery('#commentform').submit(function () {
                    _gaq.push(
                            ['_setAccount', 'UA-38642589-1'],
                            ['_trackEvent', 'comment', 'submit']
                    );
                });
            });
        </script>
									</article><!-- .post -->
					</section><!-- #content -->
							<div id="sidebar-left" class="widget-area" role="complementary">
		<aside id="nav_menu-2" class="widget widget_nav_menu"><h3 class="widget-title">Raspberry Pi:</h3><div class="menu-raspberry-pi-container"><ul id="menu-raspberry-pi" class="menu"><li id="menu-item-304" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-304"><a href="http://www.narkidae.com/projects/manta-ray/">Manta Ray</a></li>
</ul></div></aside><!-- .widget --><aside id="nav_menu-3" class="widget widget_nav_menu"><h3 class="widget-title">Robotics:</h3><div class="menu-robotics-container"><ul id="menu-robotics" class="menu"><li id="menu-item-305" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-305"><a href="http://www.narkidae.com/projects/einstepper/">Einstepper</a></li>
</ul></div></aside><!-- .widget --><aside id="nav_menu-4" class="widget widget_nav_menu"><h3 class="widget-title">Displays:</h3><div class="menu-display-container"><ul id="menu-display" class="menu"><li id="menu-item-539" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-539"><a href="http://www.narkidae.com/projects/transparent-seven-segment-display/">Transparent Display</a></li>
</ul></div></aside><!-- .widget --><aside id="nav_menu-6" class="widget widget_nav_menu"><h3 class="widget-title">Power:</h3><div class="menu-power-container"><ul id="menu-power" class="menu"><li id="menu-item-541" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-541"><a href="http://www.narkidae.com/projects/battery-shark/">Battery Shark</a></li>
</ul></div></aside><!-- .widget --><aside id="nav_menu-5" class="widget widget_nav_menu"><h3 class="widget-title">Research:</h3><div class="menu-research-container"><ul id="menu-research" class="menu"><li id="menu-item-119" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-119"><a href="http://www.narkidae.com/research/transferring-data-with-lcd-and-light-sensor/">LCD Transferring Data</a></li>
<li id="menu-item-604" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-583 current_page_item menu-item-604"><a href="http://www.narkidae.com/research/atmega-core-temperature-sensor/">ATMEGA Core Temp</a></li>
</ul></div></aside><!-- .widget -->		<div class="clear"></div>
	</div><!-- #sidebar-left -->
			</div><!-- #content-sidebar-wrap -->
				<div id="sidebar-right" class="widget-area" role="complementary">
		<aside id="wp_sidebarlogin-3" class="widget widget_wp_sidebarlogin"><h3 class="widget-title">Login</h3>
		<form name="loginform" id="loginform" action="http://www.narkidae.com/login/" method="post">
			
			<p class="login-username">
				<label for="user_login">Username</label>
				<input name="log" id="user_login" class="input" size="20" type="text">
			</p>
			<p class="login-password">
				<label for="user_pass">Password</label>
				<input name="pwd" id="user_pass" class="input" value="" size="20" type="password">
			</p>
			
			<p class="login-remember"><label><input name="rememberme" id="rememberme" value="forever" checked="checked" type="checkbox"> Remember Me</label></p>
			<p class="login-submit">
				<input name="wp-submit" id="wp-submit" class="button-primary" value="Login →" type="submit">
				<input name="redirect_to" value="http://www.narkidae.com/research/atmega-core-temperature-sensor/" type="hidden">
			</p>
			
		</form><ul class="pagenav sidebar_login_links"><li class="register-link"><a href="http://www.narkidae.com/register/">Register</a></li><li class="lost_password-link"><a href="http://www.narkidae.com/login/?action=lostpassword">Lost Password</a></li></ul></aside><!-- .widget -->		<div class="clear"></div>
	</div><!-- #sidebar-right -->
			</div><!-- #container -->
		<div id="footer">
						<div id="copyright">
				<p class="copyright">© 2014 Narkidae</p>
									<p class="credits">
																															Powered by <a href="http://www.onedesigns.com/wordpress-themes/esplanade-free-wordpress-theme" title="Esplanade Theme">Esplanade Theme</a> by <a href="http://www.onedesigns.com/" title="One Designs">One Designs</a> and <a href="http://wordpress.org/" title="WordPress">WordPress</a>											</p>
								<div class="clear"></div>
			</div><!-- #copyright -->
		</div><!-- #footer -->
	</div><!-- #wrapper -->
<script type="text/javascript" src="Arduino%20Build-in%20Temperature%20Sensor_files/8a941721347497dd80bce0c7d8073da7.js"></script>

<!-- Begin Shadowbox JS v3.0.3.10 -->
<!-- Selected Players: html, iframe, img, qt, swf, wmp -->
<script type="text/javascript">
/* <![CDATA[ */
	var shadowbox_conf = {
		animate: true,
		animateFade: true,
		animSequence: "sync",
		modal: false,
		showOverlay: true,
		overlayColor: "#000",
		overlayOpacity: "0.8",
		flashBgColor: "#000000",
		autoplayMovies: true,
		showMovieControls: true,
		slideshowDelay: 0,
		resizeDuration: "0.35",
		fadeDuration: "0.35",
		displayNav: true,
		continuous: true,
		displayCounter: true,
		counterType: "default",
		counterLimit: "10",
		viewportPadding: "20",
		handleOversize: "resize",
		handleUnsupported: "link",
		autoDimensions: false,
		initialHeight: "500",
		initialWidth: "500",
		enableKeys: true,
		skipSetup: false,
		useSizzle: false,
		flashParams: {bgcolor:"#000000", allowFullScreen:true},
		flashVars: {},
		flashVersion: "9.0.0"
	};
	Shadowbox.init(shadowbox_conf);
/* ]]> */
</script>
<!-- End Shadowbox JS -->


<div id="sb-container"><div id="sb-overlay"></div><div id="sb-wrapper"><div id="sb-title"><div id="sb-title-inner"></div></div><div id="sb-wrapper-inner"><div id="sb-body"><div id="sb-body-inner"></div><div id="sb-loading"><div id="sb-loading-inner"><span>loading</span></div></div></div></div><div id="sb-info"><div id="sb-info-inner"><div id="sb-counter"></div><div id="sb-nav"><a id="sb-nav-close" title="Close" onclick="Shadowbox.close()"></a><a id="sb-nav-next" title="Next" onclick="Shadowbox.next()"></a><a id="sb-nav-play" title="Play" onclick="Shadowbox.play()"></a><a id="sb-nav-pause" title="Pause" onclick="Shadowbox.pause()"></a><a id="sb-nav-previous" title="Previous" onclick="Shadowbox.previous()"></a></div></div></div></div></div></body></html>